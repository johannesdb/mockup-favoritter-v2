<!DOCTYPE html>

<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favorit Panel Mockup</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tippy.js@6/dist/tippy.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.16.0/tingle.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; background: #f5f5f5; padding: 40px 20px; }

```
    .demo-controls { max-width: 1400px; margin: 0 auto 16px; padding: 16px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; font-size: 14px; }
    .demo-row-1 { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .demo-row-2 { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .demo-controls strong { color: #856404; white-space: nowrap; }
    .demo-toggle { padding: 8px 16px; background: #ffc107; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; white-space: nowrap; }
    .demo-toggle:hover { background: #e0a800; }
    #demoStatus { color: #856404; font-size: 13px; }
    .device-tabs { display: flex; gap: 8px; }
    .device-tab { padding: 6px 12px; background: white; color: #856404; border: 1px solid #ffc107; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 13px; }
    .device-tab.active { background: #856404; color: white; border-color: #856404; }
    .device-tab:hover:not(.active) { background: #fff9e6; }
    
    .demo-container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .header-actions { display: flex; gap: 12px; justify-content: flex-end; align-items: center; padding: 16px 0; border-bottom: 1px solid #e0e0e0; margin-bottom: 24px; }
    .action-btn { display: flex; align-items: center; gap: 8px; padding: 10px 18px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 500; color: #333; transition: all 0.3s ease; position: relative; }
    .action-btn:hover { border-color: #667eea; background: #f8f9ff; transform: translateY(-1px); }
    .action-btn svg { width: 20px; height: 20px; }
    
    .favorite-btn { border-color: #ff4757; color: #ff4757; }
    .favorite-btn:hover { background: #fff5f7; border-color: #ff4757; }
    .favorite-btn.active { background: #ff4757; color: white; border-color: #ff4757; }
    .favorite-btn.active svg { fill: white; }
    
    .share-btn { border-color: #5f27cd; color: #5f27cd; }
    .share-btn:hover { background: #f5f0ff; border-color: #5f27cd; }
    
    .users-btn { border-color: #1e90ff; color: #1e90ff; }
    .users-btn:hover { background: #f0f8ff; border-color: #1e90ff; }
    .users-btn.active { background: #1e90ff; color: white; border-color: #1e90ff; }
    .users-btn .badge { position: absolute; top: -8px; right: -8px; background: #ff4757; color: white; border-radius: 12px; padding: 2px 7px; font-size: 11px; font-weight: 600; display: none; }
    .users-btn .badge.show { display: block; }
    
    .sync-btn { border-color: #00b894; color: #00b894; }
    .sync-btn:hover { background: #f0fdf9; border-color: #00b894; }
    .sync-btn.active { background: #00b894; color: white; border-color: #00b894; }
    
    .exhibitors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .exhibitor-card { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; cursor: pointer; position: relative; }
    .exhibitor-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
    
    .user-indicators { position: absolute; top: 12px; left: 12px; display: flex; gap: 4px; flex-wrap: wrap; max-width: calc(100% - 60px); }
    .user-indicator { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
    
    .card-favorite-btn { position: absolute; top: 12px; right: 12px; background: white; border: 2px solid #e0e0e0; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; }
    .card-favorite-btn:hover { transform: scale(1.1); border-color: #ff4757; }
    .card-favorite-btn svg { width: 16px; height: 16px; fill: none; stroke: #999; stroke-width: 2; }
    .card-favorite-btn.favorited { background: #ff4757; border-color: #ff4757; }
    .card-favorite-btn.favorited svg { fill: white; stroke: white; }
    .exhibitor-icon { font-size: 48px; text-align: center; margin-bottom: 12px; }
    .exhibitor-name { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; text-align: center; }
    .exhibitor-stand { text-align: center; color: #667eea; font-weight: 600; font-size: 14px; }
    
    /* Tippy dropdown */
    .tippy-box[data-theme~='users-dropdown'] { background-color: white; color: #333; border: 1px solid #e0e0e0; box-shadow: 0 8px 24px rgba(0,0,0,0.15); border-radius: 12px; }
    .tippy-box[data-theme~='users-dropdown'] .tippy-content { padding: 16px; }
    .dropdown-header { font-size: 14px; font-weight: 600; color: #666; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #e0e0e0; }
    .user-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    
    .user-toggle { display: flex; align-items: center; gap: 12px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: white; }
    .user-toggle:hover { border-color: #ddd; background: #f9f9f9; }
    .user-toggle.active { border-color: currentColor; background: rgba(0,0,0,0.03); }
    .user-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; flex-shrink: 0; }
    .user-info { flex: 1; min-width: 0; }
    .user-name { font-weight: 600; font-size: 14px; color: #333; }
    .user-name { font-weight: 600; font-size: 14px; color: #333; display: flex; align-items: center; gap: 6px; }
    .user-name-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .edit-name-btn { background: none; border: none; cursor: pointer; padding: 2px; color: #666; opacity: 0; transition: opacity 0.2s; display: flex; align-items: center; }
    .user-toggle:hover .edit-name-btn { opacity: 1; }
    .edit-name-btn:hover { color: #333; }
    .edit-name-btn svg { width: 14px; height: 14px; }
    .edit-name-form { display: flex; gap: 4px; margin-top: 4px; }
    .edit-name-input { flex: 1; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; font-family: inherit; }
    .edit-name-input:focus { outline: none; border-color: #667eea; }
    .edit-name-actions { display: flex; gap: 4px; }
    .edit-name-actions button { padding: 4px 8px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500; }
    .save-name-btn { background: #10b981; color: white; }
    .save-name-btn:hover { background: #059669; }
    .cancel-name-btn { background: #e5e7eb; color: #333; }
    .cancel-name-btn:hover { background: #d1d5db; }
    .user-count { font-size: 12px; color: #666; margin-top: 2px; }
    .toggle-indicator { width: 44px; height: 24px; background: #e0e0e0; border-radius: 12px; position: relative; transition: all 0.3s ease; }
    .user-toggle.active .toggle-indicator { background: currentColor; }
    .toggle-indicator::after { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .user-toggle.active .toggle-indicator::after { left: 22px; }
    
    .add-favorites-btn { width: 100%; padding: 12px; background: #f0f8ff; color: #1e90ff; border: 2px dashed #1e90ff; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease; }
    .add-favorites-btn:hover { background: #e0f2ff; border-color: #1e70ff; }
    .add-favorites-input-section { margin-top: 12px; padding: 12px; background: #f9fafb; border-radius: 8px; display: none; }
    .add-favorites-input-section.show { display: block; }
    
    .empty-state { text-align: center; padding: 32px 24px; }
    .empty-state svg { width: 64px; height: 64px; margin-bottom: 16px; opacity: 0.3; }
    .empty-state-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; }
    .empty-state-text { font-size: 14px; color: #666; line-height: 1.5; }
    
    .tingle-modal__close { top: 20px; right: 20px; }
    .tingle-modal-box { border-radius: 16px; padding: 32px; max-width: 500px; }
    .tingle-modal-box__content { padding: 0; }
    .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .modal-title { font-size: 24px; font-weight: 600; color: #333; }
    .modal-content { text-align: center; }
    
    .sync-disabled-message { text-align: center; padding: 32px 16px; color: #666; }
    .sync-disabled-message p { margin-bottom: 8px; }
    .sync-action-buttons { display: flex; flex-direction: column; gap: 12px; margin-top: 24px; }
    .sync-action-btn { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s ease; background: white; }
    .sync-action-btn.primary { background: #f0f9ff; border-color: #00b894; color: #00b894; }
    .sync-action-btn.primary:hover { background: #e0f5f0; }
    .sync-action-btn.secondary { background: #f9fafb; border-color: #667eea; color: #667eea; }
    .sync-action-btn.secondary:hover { background: #f0f2ff; }
    
    .sync-devices-list { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 24px; text-align: left; }
    .sync-devices-title { font-size: 13px; font-weight: 600; color: #666; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .sync-device-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 6px; margin-bottom: 8px; }
    .sync-device-item:last-child { margin-bottom: 0; }
    .sync-device-name { flex: 1; font-size: 14px; color: #333; display: flex; align-items: center; gap: 8px; }
    .sync-device-badge { background: #00b894; color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px; font-weight: 500; }
    .sync-device-edit { background: none; border: none; cursor: pointer; padding: 4px; color: #666; opacity: 0; transition: opacity 0.2s; }
    .sync-device-item:hover .sync-device-edit { opacity: 1; }
    .sync-device-edit:hover { color: #333; }
    .sync-device-edit svg { width: 16px; height: 16px; }
    .sync-device-edit-form { display: flex; gap: 6px; flex: 1; }
    .sync-device-input { flex: 1; padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
    .sync-device-input:focus { outline: none; border-color: #00b894; }
    
    .sync-qr-section { margin-bottom: 24px; }
    .sync-qr { width: 200px; height: 200px; margin: 0 auto 20px; background: #f5f5f5; border: 2px solid #e0e0e0; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 48px; }
    .sync-url { background: #f5f5f5; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 13px; word-break: break-all; margin-bottom: 12px; }
    .copy-url-btn { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px; }
    .copy-url-btn:hover { background: #5568d3; }
    .modal-help { margin-top: 20px; font-size: 14px; color: #666; line-height: 1.6; }
    
    .leave-sync-btn { width: 100%; padding: 12px; background: #fee; color: #dc2626; border: 1px solid #fecaca; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px; margin-top: 16px; }
    .leave-sync-btn:hover { background: #fecaca; }
    .delete-sync-btn { width: 100%; padding: 12px; background: #fff; color: #666; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px; margin-top: 16px; }
    .delete-sync-btn:hover { background: #f5f5f5; border-color: #ccc; }
    
    .join-sync-section { margin-top: 16px; padding: 16px; background: #f9fafb; border-radius: 8px; display: none; }
    .join-sync-section.show { display: block; }
    .input-label { font-size: 13px; font-weight: 600; color: #666; margin-bottom: 8px; display: block; }
    .link-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; font-family: inherit; margin-bottom: 8px; }
    .link-input:focus { outline: none; border-color: #1e90ff; }
    .input-actions { display: flex; gap: 8px; }
    .input-actions button { flex: 1; padding: 8px 16px; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; }
    .add-btn { background: #1e90ff; color: white; }
    .add-btn:hover { background: #1e70ff; }
    .cancel-btn { background: #e5e7eb; color: #333; }
    .cancel-btn:hover { background: #d1d5db; }
    
    @media (max-width: 768px) { .exhibitors-grid { grid-template-columns: 1fr; } }
</style>
```

</head>
<body>
    <div class="demo-controls">
        <div class="demo-row-1">
            <strong>üé® Demo mode:</strong>
            <button class="demo-toggle" id="demoToggle">Skift til "Ingen andres favoritter"</button>
        </div>
        <div class="demo-row-2">
            <span id="demoStatus">5 brugere + 3 enheder synkroniseret</span>
            <div class="device-tabs">
                <button class="device-tab active" data-device="1">üì± Enhed 1</button>
                <button class="device-tab" data-device="2">üíª Enhed 2</button>
            </div>
        </div>
    </div>

```
<div class="demo-container">
    <div class="header-actions">
        <button class="action-btn favorite-btn" id="favoriteBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span>Dine favoritter</span>
        </button>

        <button class="action-btn share-btn" id="shareBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
            <span>Del favoritter</span>
        </button>

        <button class="action-btn users-btn" id="usersBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Andres favoritter</span>
            <span class="badge" id="usersBadge"></span>
        </button>

        <button class="action-btn sync-btn" id="syncBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
            <span>Synkroniser enheder</span>
        </button>
    </div>

    <div class="exhibitors-grid" id="exhibitorsGrid"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tippy.js@6/dist/tippy-bundle.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.16.0/tingle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
<script>
    const exhibitors = [
        { id: 1, name: "ALBA LIGHTING", icon: "üí°", stand: "11" },
        { id: 2, name: "AUTOPRO SYSTEMS", icon: "üî•", stand: "3-11" },
        { id: 3, name: "BIOENERGY INSTALLATIONS", icon: "üåø", stand: "1S-13" },
        { id: 4, name: "CIRCUPRO SOLUTIONS", icon: "‚ôªÔ∏è", stand: "5-12" },
        { id: 5, name: "ECOPOWER STORAGE", icon: "üîã", stand: "1-24" },
        { id: 6, name: "ECOSTREAM SOLUTIONS", icon: "üå≥", stand: "1S-22" },
        { id: 7, name: "EL-VVS EXPERTS", icon: "‚úì", stand: "3-22" },
        { id: 8, name: "ELECFIX PRO", icon: "‚ö°", stand: "2-21" },
        { id: 9, name: "ENERGIAUTOMATIK", icon: "üîå", stand: "1-24" },
        { id: 10, name: "ENERGIOPTIME-RING", icon: "üìä", stand: "1-23" },
        { id: 11, name: "ENERGISPAR VARME", icon: "üå°Ô∏è", stand: "3-13" },
        { id: 12, name: "ENERGYFLOW SOLUTIONS", icon: "‚òÄÔ∏è", stand: "1S-11" },
        { id: 13, name: "GREEN TECH NORDIC", icon: "üåç", stand: "2-15" },
        { id: 14, name: "HEAT PUMP SOLUTIONS", icon: "üîÜ", stand: "4-18" },
        { id: 15, name: "SOLAR INNOVATIONS", icon: "üå§Ô∏è", stand: "2-09" },
        { id: 16, name: "SMART GRID SYSTEMS", icon: "üîã", stand: "5-21" },
        { id: 17, name: "WIND ENERGY TECH", icon: "üí®", stand: "3-07" },
        { id: 18, name: "ECO BUILDING MATERIALS", icon: "üèóÔ∏è", stand: "4-12" },
        { id: 19, name: "CLIMATE CONTROL PRO", icon: "‚ùÑÔ∏è", stand: "2-19" },
        { id: 20, name: "SUSTAINABLE HVAC", icon: "üå¨Ô∏è", stand: "5-08" },
    ];

    const allSharedUsers = [
        { id: 1, name: "Maria Jensen", customName: null, color: "#e74c3c", favorites: [1, 3, 5, 9, 12, 15, 18] },
        { id: 2, name: "Peter Nielsen", customName: null, color: "#3498db", favorites: [2, 4, 6, 10] },
        { id: 3, name: "Anna Schmidt", customName: null, color: "#2ecc71", favorites: [1, 2, 7, 11, 16, 19, 8, 14, 20] },
        { id: 4, name: "Lars Andersen", customName: null, color: "#f39c12", favorites: [3, 13, 17] },
        { id: 5, name: "Sophie Hansen", customName: null, color: "#9b59b6", favorites: [4, 6, 8, 12, 15, 18, 10, 16] },
    ];

    let device1Favorites = new Set([1, 3, 5, 7, 9, 11, 13, 15, 17]);
    let device2Favorites = new Set([2, 4, 6, 8, 10, 12, 14, 16, 18]);
    let sharedUsers = [...allSharedUsers];
    let demoMode = 'with-users';
    let currentDevice = 1;
    let myFavorites = device1Favorites;
    let showMyFavorites = false;
    let activeSharedUsers = new Set();
    let notyf, syncModal, tippyInstance;
    let userIndicatorTippyInstances = [];
    let isSyncGroup = true;
    let syncDevices = [
        { id: 1, name: 'iPhone 13', isCurrent: true, isDevice1: true },
        { id: 2, name: 'Laptop', isCurrent: false, isDevice2: true },
        { id: 3, name: 'iPad', isCurrent: false }
    ];
    let showJoinSyncInput = false;
    let showAddFavoritesInput = false;
    let editingUserId = null;
    let editingDeviceId = null;

    function init() {
        notyf = new Notyf({ duration: 3000, position: { x: 'right', y: 'bottom' } });
        syncModal = new tingle.modal({ closeMethods: ['overlay', 'button', 'escape'], closeLabel: "Luk" });
        renderExhibitors();
        setupEventListeners();
        initializeTippy();
        updateUsersButton();
        updateSyncButton();
    }

    function initializeTippy() {
        const usersBtn = document.getElementById('usersBtn');
        if (!usersBtn || typeof tippy === 'undefined') return;
        
        const contentEl = document.createElement('div');
        try {
            tippyInstance = tippy(usersBtn, {
                content: contentEl,
                theme: 'users-dropdown',
                trigger: 'click',
                interactive: true,
                allowHTML: true,
                placement: 'bottom-end',
                arrow: true,
                maxWidth: 400,
                onShow(instance) {
                    const newContent = document.createElement('div');
                    newContent.innerHTML = renderUsersDropdownContent();
                    instance.setContent(newContent);
                },
                onShown(instance) {
                    setupUsersToggleListeners();
                }
            });
        } catch (error) {
            console.error('Error initializing Tippy:', error);
        }
    }

    function renderUsersDropdownContent() {
        if (sharedUsers.length === 0) {
            return `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <div class="empty-state-title">Ingen delte favoritter endnu</div>
                    <div class="empty-state-text">Inds√¶t et delingslink fra en anden bruger for at se deres favoritter.</div>
                </div>
                <button class="add-favorites-btn" id="addFavoritesBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Tilf√∏j favoritter
                </button>
                <div class="add-favorites-input-section ${showAddFavoritesInput ? 'show' : ''}" id="addFavoritesInput">
                    <label class="input-label">Inds√¶t delingslink:</label>
                    <input type="text" class="link-input" id="favoritesLinkInput" placeholder="https://energimesse.dk/share?id=abc123">
                    <div class="input-actions">
                        <button class="add-btn" id="submitFavoritesLink">Tilf√∏j</button>
                        <button class="cancel-btn" id="cancelAddFavorites">Annuller</button>
                    </div>
                </div>
            `;
        }

        return `
            <div class="dropdown-header">Vis favoritter fra:</div>
            <div class="user-list">
                ${sharedUsers.map(user => {
                    const displayName = user.customName || user.name;
                    const isEditing = editingUserId === user.id;
                    return `
                        <div class="user-toggle ${activeSharedUsers.has(user.id) ? 'active' : ''}" 
                             data-user-id="${user.id}" 
                             style="color: ${user.color}">
                            <div class="user-avatar" style="background: ${user.color}">
                                ${displayName.split(' ').map(n => n[0]).join('')}
                            </div>
                            <div class="user-info">
                                ${isEditing ? `
                                    <div class="edit-name-form">
                                        <input 
                                            type="text" 
                                            class="edit-name-input" 
                                            id="editInput_${user.id}"
                                            value="${displayName}"
                                            placeholder="Navn"
                                        />
                                        <div class="edit-name-actions">
                                            <button class="save-name-btn" onclick="saveName(${user.id})">‚úì</button>
                                            <button class="cancel-name-btn" onclick="cancelEdit()">‚úï</button>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="user-name">
                                        <span class="user-name-text">${displayName}</span>
                                        <button class="edit-name-btn" onclick="startEdit(event, ${user.id})">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                `}
                                <div class="user-count">${user.favorites.length} favoritter</div>
                            </div>
                            <div class="toggle-indicator"></div>
                        </div>
                    `;
                }).join('')}
            </div>
            <button class="add-favorites-btn" id="addFavoritesBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Tilf√∏j favoritter
            </button>
            <div class="add-favorites-input-section ${showAddFavoritesInput ? 'show' : ''}" id="addFavoritesInput">
                <label class="input-label">Inds√¶t delingslink:</label>
                <input type="text" class="link-input" id="favoritesLinkInput" placeholder="https://energimesse.dk/share?id=abc123">
                <div class="input-actions">
                    <button class="add-btn" id="submitFavoritesLink">Tilf√∏j</button>
                    <button class="cancel-btn" id="cancelAddFavorites">Annuller</button>
                </div>
            </div>
        `;
    }

    function setupUsersToggleListeners() {
        document.querySelectorAll('.user-toggle').forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                if (e.target.closest('.edit-name-btn') || 
                    e.target.closest('.edit-name-form') ||
                    editingUserId !== null) {
                    return;
                }
                e.preventDefault();
                e.stopPropagation();
                const userId = parseInt(this.dataset.userId);
                if (!isNaN(userId)) {
                    toggleUser(userId);
                }
            });
        });
        
        const addFavBtn = document.getElementById('addFavoritesBtn');
        if (addFavBtn) {
            addFavBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showAddFavoritesInput = !showAddFavoritesInput;
                if (tippyInstance) {
                    const newContent = document.createElement('div');
                    newContent.innerHTML = renderUsersDropdownContent();
                    tippyInstance.setContent(newContent);
                    setTimeout(() => {
                        setupUsersToggleListeners();
                        if (showAddFavoritesInput) {
                            const input = document.getElementById('favoritesLinkInput');
                            if (input) input.focus();
                        }
                    }, 0);
                }
            });
        }
        
        const submitBtn = document.getElementById('submitFavoritesLink');
        if (submitBtn) {
            submitBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const input = document.getElementById('favoritesLinkInput');
                if (input && input.value.trim()) {
                    addFavoritesFromLink(input.value.trim());
                }
            });
        }
        
        const cancelBtn = document.getElementById('cancelAddFavorites');
        if (cancelBtn) {
            cancelBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showAddFavoritesInput = false;
                if (tippyInstance) {
                    const newContent = document.createElement('div');
                    newContent.innerHTML = renderUsersDropdownContent();
                    tippyInstance.setContent(newContent);
                    setTimeout(() => setupUsersToggleListeners(), 0);
                }
            });
        }
    }

    function addFavoritesFromLink(link) {
        const newUser = {
            id: Date.now(),
            name: `Bruger ${sharedUsers.length + 1}`,
            customName: null,
            color: ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6'][sharedUsers.length % 5],
            favorites: [1, 5, 8, 12]
        };
        
        sharedUsers.push(newUser);
        allSharedUsers.push(newUser);
        showAddFavoritesInput = false;
        notyf.success('Favoritter tilf√∏jet!');
        
        if (tippyInstance) {
            const newContent = document.createElement('div');
            newContent.innerHTML = renderUsersDropdownContent();
            tippyInstance.setContent(newContent);
            setTimeout(() => setupUsersToggleListeners(), 0);
        }
    }

    function startEdit(event, userId) {
        event.preventDefault();
        event.stopPropagation();
        editingUserId = userId;
        
        if (tippyInstance) {
            const newContent = document.createElement('div');
            newContent.innerHTML = renderUsersDropdownContent();
            tippyInstance.setContent(newContent);
            setTimeout(() => {
                setupUsersToggleListeners();
                const input = document.getElementById(`editInput_${userId}`);
                if (input) {
                    input.focus();
                    input.select();
                }
            }, 0);
        }
    }

    function saveName(userId) {
        const input = document.getElementById(`editInput_${userId}`);
        if (input) {
            const newName = input.value.trim();
            if (newName) {
                const userIndex = sharedUsers.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    sharedUsers[userIndex].customName = newName;
                }
                const allUserIndex = allSharedUsers.findIndex(u => u.id === userId);
                if (allUserIndex !== -1) {
                    allSharedUsers[allUserIndex].customName = newName;
                }
                notyf.success('Navn opdateret!');
            }
        }
        cancelEdit();
    }

    function cancelEdit() {
        editingUserId = null;
        if (tippyInstance) {
            const newContent = document.createElement('div');
            newContent.innerHTML = renderUsersDropdownContent();
            tippyInstance.setContent(newContent);
            setTimeout(() => setupUsersToggleListeners(), 0);
        }
    }

    window.startEdit = startEdit;
    window.saveName = saveName;
    window.cancelEdit = cancelEdit;

    function toggleUser(userId) {
        if (activeSharedUsers.has(userId)) {
            activeSharedUsers.delete(userId);
        } else {
            activeSharedUsers.add(userId);
        }
        
        updateUsersButton();
        
        if (tippyInstance) {
            const newContent = document.createElement('div');
            newContent.innerHTML = renderUsersDropdownContent();
            tippyInstance.setContent(newContent);
            setTimeout(() => setupUsersToggleListeners(), 0);
        }
        
        renderExhibitors();
    }

    function updateUsersButton() {
        const usersBtn = document.getElementById('usersBtn');
        const badge = document.getElementById('usersBadge');
        
        if (activeSharedUsers.size > 0) {
            usersBtn.classList.add('active');
            badge.textContent = activeSharedUsers.size;
            badge.classList.add('show');
        } else {
            usersBtn.classList.remove('active');
            badge.classList.remove('show');
        }
    }

    function renderExhibitors() {
        const grid = document.getElementById('exhibitorsGrid');
        let displayExhibitors = exhibitors;

        userIndicatorTippyInstances.forEach(instance => instance.destroy());
        userIndicatorTippyInstances = [];

        if (showMyFavorites && activeSharedUsers.size > 0) {
            const othersUnion = new Set();
            activeSharedUsers.forEach(userId => {
                const user = sharedUsers.find(u => u.id === userId);
                if (user) {
                    user.favorites.forEach(fav => othersUnion.add(fav));
                }
            });
            
            const intersection = new Set();
            myFavorites.forEach(fav => {
                if (othersUnion.has(fav)) {
                    intersection.add(fav);
                }
            });
            
            displayExhibitors = exhibitors.filter(e => intersection.has(e.id));
            
        } else if (showMyFavorites) {
            displayExhibitors = exhibitors.filter(e => myFavorites.has(e.id));
            
        } else if (activeSharedUsers.size > 0) {
            const othersUnion = new Set();
            activeSharedUsers.forEach(userId => {
                const user = sharedUsers.find(u => u.id === userId);
                if (user) {
                    user.favorites.forEach(fav => othersUnion.add(fav));
                }
            });
            
            displayExhibitors = exhibitors.filter(e => othersUnion.has(e.id));
        }

        grid.innerHTML = displayExhibitors.map(exhibitor => {
            const usersWhoFavorited = sharedUsers.filter(user => 
                activeSharedUsers.has(user.id) && user.favorites.includes(exhibitor.id)
            );
            
            const isMyFavorite = myFavorites.has(exhibitor.id);

            return `
                <div class="exhibitor-card">
                    ${usersWhoFavorited.length > 0 ? `
                        <div class="user-indicators">
                            ${usersWhoFavorited.map(user => `
                                <div class="user-indicator" data-user-name="${user.customName || user.name}" style="background: ${user.color}">
                                    ${(user.customName || user.name).split(' ').map(n => n[0]).join('')}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <button class="card-favorite-btn ${isMyFavorite ? 'favorited' : ''}" onclick="toggleFavorite(${exhibitor.id})">
                        <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    </button>
                    <div class="exhibitor-icon">${exhibitor.icon}</div>
                    <div class="exhibitor-name">${exhibitor.name}</div>
                    <div class="exhibitor-stand">Stand: ${exhibitor.stand}</div>
                </div>
            `;
        }).join('');

        setTimeout(() => {
            document.querySelectorAll('.user-indicator').forEach(indicator => {
                const userName = indicator.dataset.userName;
                if (typeof tippy !== 'undefined') {
                    const instance = tippy(indicator, {
                        content: userName,
                        placement: 'top',
                        arrow: true
                    });
                    userIndicatorTippyInstances.push(instance);
                }
            });
        }, 0);
    }

    function toggleFavorite(id) {
        if (currentDevice === 1) {
            device1Favorites.has(id) ? device1Favorites.delete(id) : device1Favorites.add(id);
        } else {
            device2Favorites.has(id) ? device2Favorites.delete(id) : device2Favorites.add(id);
        }
        myFavorites = currentDevice === 1 ? device1Favorites : device2Favorites;
        renderExhibitors();
    }

    function updateSyncButton() {
        const syncBtn = document.getElementById('syncBtn');
        if (isSyncGroup && syncDevices.length > 0) {
            syncBtn.classList.add('active');
        } else {
            syncBtn.classList.remove('active');
        }
    }

    function renderSyncModal() {
        let content = '';
        
        if (!isSyncGroup || syncDevices.length === 0) {
            content = `
                <div class="modal-header"><h2 class="modal-title">Synkronisering</h2></div>
                <div class="modal-content">
                    <div class="sync-disabled-message">
                        <p>Du er ikke i en sync-gruppe.</p>
                        <p style="font-size: 13px; margin-top: 16px;">Opret en ny sync-gruppe eller tilslut denne enhed til en eksisterende gruppe.</p>
                    </div>
                    <div class="sync-action-buttons">
                        <button class="sync-action-btn primary" id="createSyncBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                            </svg>
                            Opret ny sync-gruppe
                        </button>
                        <button class="sync-action-btn secondary" id="joinSyncBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                            Tilslut til eksisterende gruppe
                        </button>
                    </div>
                    <div class="join-sync-section ${showJoinSyncInput ? 'show' : ''}" id="joinSyncSection">
                        <label class="input-label">Inds√¶t sync-link fra en anden enhed:</label>
                        <input type="text" class="link-input" id="syncLinkInput" placeholder="https://energimesse.dk/sync?session=abc123">
                        <div class="input-actions">
                            <button class="add-btn" id="submitSyncLink">Tilslut</button>
                            <button class="cancel-btn" id="cancelJoinSync">Annuller</button>
                        </div>
                        <p style="font-size: 12px; color: #666; margin-top: 8px;">‚ÑπÔ∏è Dine eksisterende favoritter vil blive sammenlagt med gruppens favoritter.</p>
                    </div>
                </div>
            `;
        } else {
            const devicesWithCurrent = syncDevices.map(d => ({
                ...d,
                isCurrent: (currentDevice === 1 && d.isDevice1) || (currentDevice === 2 && d.isDevice2)
            }));
            
            const showLeaveButton = syncDevices.length > 1;
            const showDeleteButton = syncDevices.length === 1;
            
            content = `
                <div class="modal-header"><h2 class="modal-title">Synkronisering</h2></div>
                <div class="modal-content">
                    <div class="sync-devices-list">
                        <div class="sync-devices-title">Enheder i gruppen</div>
                        ${devicesWithCurrent.map(device => {
                            const isEditing = editingDeviceId === device.id;
                            return `
                                <div class="sync-device-item">
                                    ${isEditing ? `
                                        <div class="sync-device-edit-form">
                                            <input 
                                                type="text" 
                                                class="sync-device-input" 
                                                id="deviceInput_${device.id}"
                                                value="${device.name}"
                                                placeholder="Enhedsnavn"
                                            />
                                            <div class="edit-name-actions">
                                                <button class="save-name-btn" onclick="saveDeviceName(${device.id})">‚úì</button>
                                                <button class="cancel-name-btn" onclick="cancelDeviceEdit()">‚úï</button>
                                            </div>
                                        </div>
                                    ` : `
                                        <div class="sync-device-name">
                                            ${device.name}
                                            ${device.isCurrent ? '<span class="sync-device-badge">Denne</span>' : ''}
                                        </div>
                                        <button class="sync-device-edit" onclick="startDeviceEdit(event, ${device.id})">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                    `}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="sync-qr-section">
                        <div class="sync-qr">üì±</div>
                        <p style="margin-bottom: 12px; color: #666; font-size: 14px;">Del dette link med dine andre enheder:</p>
                        <div class="sync-url">https://energimesse.dk/sync?session=abc123xyz</div>
                        <button class="copy-url-btn" id="copySyncUrlBtn">Kopi√©r link</button>
                        <div class="modal-help">
                            <strong>Tilslut andre enheder:</strong><br>
                            ‚Ä¢ <strong>I browser:</strong> √Öbn linket direkte<br>
                            ‚Ä¢ <strong>I PWA app:</strong> G√• til "Synkroniser enheder" ‚Üí "Tilslut til gruppe" ‚Üí inds√¶t linket
                            <br><br>
                            Favoritter synkroniseres automatisk hvert 5. minut (Last Write Wins).
                        </div>
                    </div>
                    
                    ${showLeaveButton ? '<button class="leave-sync-btn" id="leaveSyncBtn">Forlad sync-gruppe</button>' : ''}
                    ${showDeleteButton ? '<button class="delete-sync-btn" id="deleteSyncBtn">Annuller</button>' : ''}
                </div>
            `;
        }
        
        syncModal.setContent(content);
        
        setTimeout(() => {
            const copyBtn = document.getElementById('copySyncUrlBtn');
            if (copyBtn) copyBtn.addEventListener('click', () => notyf.success('Link kopieret!'));
            
            const leaveBtn = document.getElementById('leaveSyncBtn');
            if (leaveBtn) leaveBtn.addEventListener('click', leaveSync);
            
            const deleteBtn = document.getElementById('deleteSyncBtn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', cancelSyncGroup);
            }
            
            const createBtn = document.getElementById('createSyncBtn');
            if (createBtn) createBtn.addEventListener('click', createSyncGroup);
            
            const joinBtn = document.getElementById('joinSyncBtn');
            if (joinBtn) joinBtn.addEventListener('click', () => {
                showJoinSyncInput = !showJoinSyncInput;
                renderSyncModal();
            });
            
            const submitBtn = document.getElementById('submitSyncLink');
            if (submitBtn) submitBtn.addEventListener('click', () => {
                const input = document.getElementById('syncLinkInput');
                if (input && input.value.trim()) joinSyncGroup(input.value.trim());
            });
            
            const cancelBtn = document.getElementById('cancelJoinSync');
            if (cancelBtn) cancelBtn.addEventListener('click', () => {
                showJoinSyncInput = false;
                renderSyncModal();
            });
        }, 0);
    }

    function leaveSync() {
        if (confirm('Er du sikker p√• at du vil forlade sync-gruppen?')) {
            syncDevices = syncDevices.filter(d => 
                currentDevice === 1 ? !d.isDevice1 : !d.isDevice2
            );
            if (syncDevices.length === 0) isSyncGroup = false;
            updateSyncButton();
            renderSyncModal();
            notyf.success('Du har forladt sync-gruppen');
        }
    }
    
    function cancelSyncGroup() {
        syncDevices = [];
        isSyncGroup = false;
        updateSyncButton();
        renderSyncModal();
        notyf.success('Sync-gruppe slettet');
    }

    function createSyncGroup() {
        syncDevices = [{
            id: Date.now(),
            name: currentDevice === 1 ? 'iPhone 13' : 'Laptop',
            isCurrent: true,
            isDevice1: currentDevice === 1,
            isDevice2: currentDevice === 2
        }];
        isSyncGroup = true;
        showJoinSyncInput = false;
        updateSyncButton();
        renderSyncModal();
        notyf.success('Sync-gruppe oprettet!');
    }
    
    function joinSyncGroup(link) {
        const thisDevice = {
            id: Date.now(),
            name: currentDevice === 1 ? 'iPhone 13' : 'Laptop',
            isCurrent: true,
            isDevice1: currentDevice === 1,
            isDevice2: currentDevice === 2
        };
        
        syncDevices = [
            { id: Date.now() + 1, name: 'iPad Pro', isCurrent: false },
            { id: Date.now() + 2, name: 'MacBook', isCurrent: false },
            thisDevice
        ];
        
        isSyncGroup = true;
        showJoinSyncInput = false;
        updateSyncButton();
        renderSyncModal();
        notyf.success('Tilsluttet sync-gruppe!');
        setTimeout(() => notyf.success('Favoritter sammenlagt!'), 2000);
    }

    function startDeviceEdit(event, deviceId) {
        event.preventDefault();
        event.stopPropagation();
        editingDeviceId = deviceId;
        renderSyncModal();
        
        setTimeout(() => {
            const input = document.getElementById(`deviceInput_${deviceId}`);
            if (input) {
                input.focus();
                input.select();
            }
        }, 0);
    }

    function saveDeviceName(deviceId) {
        const input = document.getElementById(`deviceInput_${deviceId}`);
        if (input) {
            const newName = input.value.trim();
            if (newName) {
                const deviceIndex = syncDevices.findIndex(d => d.id === deviceId);
                if (deviceIndex !== -1) {
                    syncDevices[deviceIndex].name = newName;
                }
                notyf.success('Enhedsnavn opdateret!');
            }
        }
        cancelDeviceEdit();
    }

    function cancelDeviceEdit() {
        editingDeviceId = null;
        renderSyncModal();
    }

    window.toggleFavorite = toggleFavorite;
    window.startDeviceEdit = startDeviceEdit;
    window.saveDeviceName = saveDeviceName;
    window.cancelDeviceEdit = cancelDeviceEdit;

    function setupEventListeners() {
        document.getElementById('favoriteBtn').addEventListener('click', function() {
            showMyFavorites = !showMyFavorites;
            this.classList.toggle('active');
            renderExhibitors();
        });

        document.querySelectorAll('.device-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const deviceNum = parseInt(this.dataset.device);
                currentDevice = deviceNum;
                myFavorites = currentDevice === 1 ? device1Favorites : device2Favorites;
                showMyFavorites = false;
                document.getElementById('favoriteBtn').classList.remove('active');
                document.querySelectorAll('.device-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                renderExhibitors();
            });
        });

        document.getElementById('demoToggle').addEventListener('click', function() {
            if (this.textContent.includes('Ingen')) {
                isSyncGroup = false;
                syncDevices = [];
                this.textContent = 'Skift til "Med andres favoritter"';
                document.getElementById('demoStatus').textContent = 'Ingen synkronisering';
            } else {
                isSyncGroup = true;
                syncDevices = [
                    { id: 1, name: 'iPhone 13', isCurrent: true, isDevice1: true },
                    { id: 2, name: 'Laptop', isCurrent: false, isDevice2: true },
                    { id: 3, name: 'iPad', isCurrent: false }
                ];
                this.textContent = 'Skift til "Ingen andres favoritter"';
                document.getElementById('demoStatus').textContent = '3 enheder synkroniseret';
            }
            updateSyncButton();
        });

        document.getElementById('syncBtn').addEventListener('click', function() {
            renderSyncModal();
            syncModal.open();
        });
    }

    window.addEventListener('DOMContentLoaded', init);
</script>
```

</body>
</html>